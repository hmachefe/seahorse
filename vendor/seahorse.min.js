/*! seahorse - v0.0.5 - 2014-07-27 */
!function(a){var b={_getExtension:function(a){var b=a.lastIndexOf(".");return 0>b?"":a.substr(b)},_allowCrossDomain:function(a,b,c){b.header("Access-Control-Allow-Origin","*"),b.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE"),b.header("Access-Control-Allow-Headers","Content-Type, Authorization"),"OPTIONS"==a.method?b.send(200):c()}};a.utils=b}(this),function(a){"use strict";var b=(require("util"),{config:[],checkConfig:function(a){try{{JSON.stringify(a)}if(!1==a instanceof Array)throw"object is not an array";a.forEach(function(a,b){if("undefined"==typeof a.httpRequest||"undefined"==typeof a.httpResponse)throw"["+b+"] httpResponse or httpRequest missing";if("undefined"==typeof a.httpRequest.method||"undefined"==typeof a.httpRequest.path)throw"["+b+"] method or path is missing in httpRequest key";if("undefined"==typeof a.httpResponse.statusCode)throw"["+b+"] statusCode is missing in httpResponse key";if("GET"===a.httpRequest.method.toUpperCase()&&"undefined"==typeof a.httpResponse.body&&"undefined"==typeof a.httpResponse.file)throw"["+b+"] body and file are missing in httpResponse key"})}catch(b){return!1}return!0},setConfig:function(a){return this.checkConfig(a)?(this.config=a,!0):!1},updateConfig:function(a){var b=this;return this.checkConfig(a)?(a.forEach(function(a){var c=b.config.every(function(b){return b.httpRequest.path===a.httpRequest.path&&b.httpRequest.method===a.httpRequest.method&&b.httpRequest.query===a.httpRequest.query?(b.httpResponse=a.httpResponse,!1):!0});c===!0&&b.config.push(a)}),!0):!1},getConfig:function(){return this.config},_matchPath:function(a,b){return a.httpRequest.method.toUpperCase()===b.method.toUpperCase()&&a.httpRequest.path===b.params[0]},all:function(a,b){var c={},d=this,e=this.config.some(function(b){if(d._matchPath(b,a)){if("undefined"!=typeof b.httpRequest.query){for(var e in b.httpRequest.query)if("undefined"==typeof a.query[e]||b.httpRequest.query[e].toString()!==a.query[e].toString())return!1;return c=b,!0}return c=b,!0}return!1});e?setTimeout(function(){"undefined"!=typeof c.httpResponse.headers&&c.httpResponse.headers.forEach(function(a){b.setHeader(a.name,a.values)}),"undefined"!=typeof c.httpResponse.body?b.send(c.httpResponse.body,c.httpResponse.statusCode):"undefined"!=typeof c.httpResponse.file?b.status(c.httpResponse.statusCode).sendfile(c.httpResponse.file):b.send("",c.httpResponse.statusCode)},"undefined"==typeof c.httpResponse.delay?1:c.httpResponse.delay):b.send("Not found",404)}});a.routes=b}(this),function(a,b,c){"use strict";var d=(require("fs"),require("express")),e=require("util"),f=d(),g={_server:null,start:function(a,g){if(f.use(b._allowCrossDomain),f.use(d.json()),f.use(d.urlencoded()),e.log("start seahorse server on port "+g),f.get("/_config",function(a,b){b.setHeader("Content-Type","application/json; charset=utf-8"),b.send(JSON.stringify(c.getConfig()),200)}),f.post("/_config",function(a,b){var d=a.body;c.setConfig(d,f),b.setHeader("Content-Type","application/json; charset=utf-8"),b.send(JSON.stringify(c.getConfig()),200)}),f.put("/_config",function(a,b){var d=a.body;c.updateConfig(d,f),b.setHeader("Content-Type","application/json; charset=utf-8"),b.send(JSON.stringify(c.getConfig()),200)}),"undefined"==typeof a)throw"initial config is undefined";c.setConfig(a,f),f.all("*",function(a,b){c.all(a,b)}),this._server=f.listen(g)},stop:function(){null!==this._server&&(e.log("stop seahorse server"),this._server.close())}};a.server=g}(this,this.utils,this.routes);